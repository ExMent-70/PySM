# Руководство: Архивирование документов (v1.05.03)

## 1. Назначение
Этот скрипт автоматизирует процесс "архивации" одного или нескольких `.psd` файлов. Под архивацией понимается следующий трехэтапный процесс для каждого найденного файла:

1.  **Выполнение экшена**: К открытому документу применяется указанный экшен (по умолчанию `_АРХИВ_` из набора `PySM Actions`). Обычно этот экшен выполняет необходимые действия по подготовке файла, например, сведение слоев.
2.  **Сохранение в JPG**: Документ сохраняется в формате `.jpg` с максимальным качеством в указанную папку назначения.
3.  **Пересохранение PSD**: Исходный `.psd` файл перезаписывается (сохраняется) с уже примененными изменениями.

## 2. Параметры

- **Исходная папка (`ps_source_folder`)**
  - **Тип:** Путь к папке
  - **Обязательный:** Нет (по умолчанию `{wf_psd_path}/{wf_session_name}/Альбом/Фото`)
  - Папка, в которой скрипт будет искать `.psd` файлы для обработки. Если параметр не указан, появится системный диалог для выбора папки.

- **Папка для JPG (`ps_output_folder`)**
  - **Тип:** Путь к папке (по умолчанию `{wf_psd_path}/{wf_session_name}/Выпускникам`)
  - **Обязательный:** Нет
  - Папка, куда будут сохранены итоговые `.jpg` файлы. Если параметр не указан, появится системный диалог для выбора папки.

- **Имя набора экшенов (`ps_action_set`)**
  - **Тип:** Строка
  - **Обязательный:** Нет (по умолчанию `PySM_Actions`)
  - Имя набора, в котором находится экшен для выполнения.

- **Имя экшена (`ps_action_name`)**
  - **Тип:** Строка
  - **Обязательный:** Нет (по умолчанию `PySM_ARCHIVE`)
  - Имя самого экшена, который будет применен к каждому файлу.

- **Рекурсивный поиск (`ps_recursive`)**
  - **Тип:** Флаг (Да/Нет)
  - **Обязательный:** Нет (по умолчанию выключен)
  - Если флаг установлен, скрипт будет искать `.psd` файлы не только в указанной исходной папке, но и во всех ее подпапках.

## 3. Сценарии использования

### Интерактивный режим
Просто запустите скрипт, не указывая никаких параметров. Он последовательно попросит вас выбрать исходную папку и папку для сохранения результатов через стандартные диалоговые окна.

### Автоматический режим
Укажите все пути и, при необходимости, имена экшенов в параметрах. Скрипт выполнит всю работу без каких-либо диалогов.

**Пример:**
- `ps_source_folder`: `D:\Photos\Project_Summer\PSD_to_archive`
- `ps_output_folder`: `D:\Photos\Project_Summer\JPG_final`
- `ps_recursive`: `true`

В этом случае скрипт обработает все `.psd` файлы в папке `PSD_to_archive` и всех ее подпапках, а `.jpg` сложит в `JPG_final`.```

### Что было улучшено:

1.  **Единая функция `get_config`:** Вся логика получения параметров, включая разрешение путей через `ConfigResolver` и интерактивный запрос недостающих путей, теперь инкапсулирована в одной функции.
2.  **Чистая `main`:** Главная функция теперь только оркестрирует процесс, не занимаясь подготовкой данных.
3.  **Корректный `tqdm`:** Прогресс-бар использует `with` и `update(1)` для правильного и своевременного обновления.
