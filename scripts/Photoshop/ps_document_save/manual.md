# Руководство по использованию скрипта "Сохранить документ" (v1.05.03)

## 1. Назначение

Этот скрипт предоставляет гибкий способ сохранения активного документа в Adobe Photoshop. Его главная особенность — интеллектуальное поведение, которое имитирует стандартную команду "Сохранить" (Ctrl+S).

Скрипт может работать в двух основных режимах:
1.  **Интеллектуальный режим (по умолчанию):** Скрипт сам определяет, как сохранить документ.
2.  **Принудительный режим "Сохранить как...":** Пользователь явно указывает путь, и скрипт сохраняет документ по этому пути.

## 2. Параметры

-   **Путь для сохранения** (`ps_save_path`):
    -   **Тип:** Путь к файлу
    -   **Обязательный:** Нет
    -   **Описание:** Если этот параметр указан, скрипт принудительно выполнит операцию "Сохранить как..." по заданному пути. Расширение файла (например, `.png`, `.psd`) определит формат сохранения.

-   **Сохранить как копию** (`ps_save_as_copy`):
    -   **Тип:** Флаг (Да/Нет)
    -   **Обязательный:** Нет
    -   **Описание:** Работает только в связке с параметром `Путь для сохранения`. Если этот флаг включен, Photoshop сохранит копию документа, а оригинальный (активный) документ останется без изменений. Если флаг выключен, активный документ будет переименован и связан с новым путем.

## 3. Логика работы

### Сценарий A: Интеллектуальный режим (параметр `ps_save_path` не указан)

1.  Скрипт проверяет, есть ли в активном документе несохраненные изменения. Если нет — работа успешно завершается.
2.  Если изменения есть, скрипт пытается определить, является ли документ "новым" (никогда не сохранялся на диск), пытаясь получить его полный путь.
3.  **Если путь получить удалось:** Выполняется стандартная команда `Сохранить`.
4.  **Если при получении пути произошла ошибка (COMError):** Скрипт понимает, что документ новый, и открывает системное диалоговое окно "Сохранить как...".

### Сценарий B: Принудительный режим (параметр `ps_save_path` указан)

1.  Скрипт игнорирует состояние документа.
2.  Он немедленно выполняет операцию "Сохранить как..." по пути, указанному в `ps_save_path`.
3.  Формат сохранения определяется по расширению файла.

## 4. Динамическое формирование путей (Шаблоны)

В принудительном режиме параметр **Путь для сохранения** (`ps_save_path`) поддерживает использование плейсхолдеров вида `{имя_переменной}`.

## 5. Зависимости и Коды Выхода

-   **Обязательные библиотеки:** `photoshop-python-api`, `comtypes`.
-   **Опциональные библиотеки:** `PySide6` (требуется только для диалогового окна).
-   **Код выхода `0` (Успех):** Операция сохранения завершена успешно/отменена.
-   **Код выхода `1` (Ошибка):** Произошла ошибка.