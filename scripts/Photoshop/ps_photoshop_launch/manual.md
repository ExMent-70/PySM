# Руководство по использованию скрипта "Запуск Photoshop" (v1.05.03)

## 1. Назначение

Этот скрипт является служебным и предназначен для подготовки рабочей среды перед выполнением операций в Adobe Photoshop.

Его основные задачи:
1.  Проверить, запущен ли уже Adobe Photoshop.
2.  Если нет — найти и запустить приложение.
3.  Дождаться полной загрузки программы.
4.  Проверить, что скрипты могут взаимодействовать с Photoshop через программный интерфейс (API).

Этот скрипт рекомендуется ставить в наборах первым, перед любыми другими скриптами, которые должны работать с Photoshop.

## 2. Параметры

-   **Путь к папке Photoshop** (`ps_app_dir`):
    -   **Тип:** Путь к папке
    -   **Обязательный:** Нет
    -   **Описание:** Позволяет вручную указать, где находится папка с приложением Adobe Photoshop. Это полезно, если у вас установлено несколько версий программы или она установлена в нестандартное место.

## 3. Логика работы

1.  **Проверка процесса:** Скрипт сначала проверяет, есть ли в системе запущенный процесс `Photoshop.exe` (в Windows) или `Adobe Photoshop` (в macOS).
2.  **Если Photoshop запущен:** Скрипт переходит сразу к шагу 5 (проверка API).
3.  **Если Photoshop не запущен:**
    -   **Поиск пути:** Скрипт пытается определить путь к исполняемому файлу. Приоритет следующий:
        1.  Используется путь, явно указанный в параметре `Путь к папке Photoshop`.
        2.  Если путь не указан или там ничего не найдено, выполняется автоматический поиск в стандартных местах установки (через реестр Windows или в папке `/Applications` на macOS).
    -   **Запуск:** После нахождения пути, скрипт запускает приложение.
    -   **Ожидание:** Скрипт ожидает до 160 секунд, пока процесс Photoshop не появится в системе и не будет готов к работе.
4.  **Если найти или запустить не удалось:** Скрипт завершается с ошибкой.
5.  **Проверка API:** После того как Photoshop запущен, скрипт пытается установить с ним соединение. Если соединение успешно, скрипт выводит в лог имя и версию программы.
6.  **Если подключиться не удалось:** Скрипт завершается с ошибкой. Это может случиться, если Photoshop завис или показывает модальное диалоговое окно (например, окно приветствия).

## 4. Динамическое формирование путей (Шаблоны)

При работе в управляемой среде PyScriptManager параметр **Путь к папке Photoshop** поддерживает использование плейсхолдеров вида `{имя_переменной}`. При запуске скрипт автоматически заменит их на значения из Контекста Коллекции.

### Пример использования:
Если в контексте есть переменная `photoshop_path` со значением `D:\PortableApps\Photoshop`, то в параметре скрипта можно указать `{photoshop_path}`, и скрипт будет искать программу именно там.

## 5. Коды выхода

-   **Код выхода `0` (Успех):** Photoshop запущен и готов к приему команд от других скриптов.
-   **Код выхода `1` (Ошибка):** Произошла ошибка. Это может быть:
    -   Не удалось найти исполняемый файл Photoshop.
    -   Не удалось запустить процесс.
    -   Таймаут ожидания запуска истек.
    -   Не удалось подключиться к API.

    При получении кода `1` выполнение всей цепочки скриптов будет немедленно **остановлено**.