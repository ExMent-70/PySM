# Руководство по скрипту "Image Background Remover" (v1.3.2)

## 1. Назначение

Этот скрипт предназначен для высококачественного удаления фона с изображений. Он использует нейросетевые модели из семейств **RMBG** и **BiRefNet**, полностью настраивается через графический интерфейс и поддерживает многопоточную обработку для значительного ускорения работы.

Результатом работы являются изображения с прозрачным (или цветным) фоном и/или черно-белые маски. Имена выходных файлов включают название модели, что удобно для сравнения результатов.

## 2. Принцип работы

Скрипт использует гибридную систему конфигурации:

1.  **`config.toml`**: Файл в папке со скриптом, который содержит "продвинутые" и редко изменяемые настройки (например, путь к общей папке со всеми моделями `model_root`, цвет фона по умолчанию `background_color`).
2.  **Интерфейс PySM**: Все основные параметры для ежедневной работы задаются через графический интерфейс. **Настройки, заданные в интерфейсе, всегда имеют приоритет над `config.toml`.**

## 3. Детальное описание параметров

### Основные настройки

-   **`input_dir`**: Указывает на папку, содержащую исходные изображения для обработки.
-   **`output_dir`**: Указывает на папку, куда будут сохраняться все результаты.
-   **`threads`**: Устанавливает количество потоков для одновременной обработки. `0` — автоматический режим (рекомендуется).

### Выбор модели

-   **`processor_type`**: Выбор основного "семейства" моделей (`rmbg` или `birefnet`).

-   **`model_rmbg`**: Выбор конкретной модели, если `processor_type` установлен в `rmbg`. Доступны: `RMBG-2.0`, `INSPYRENET`, `BEN`, `BEN2`.

-   **`model_birefnet`**: Выбор конкретной модели, если `processor_type` установлен в `birefnet`.

-   **`img_scale`**: (Только для `processor: birefnet`) Устанавливает разрешение для обработки. `0` — использовать оптимальное разрешение по умолчанию для выбранной модели. Для ручной настройки ориентируйтесь на следующие рекомендованные диапазоны (Min / Max):
    *   `BiRefNet-general`: 512 / 2048
    *   `BiRefNet_512x512`: 256 / 1024
    *   `BiRefNet-HR`: 1024 / 2560
    *   `BiRefNet-portrait`: 512 / 2048
    *   `BiRefNet-matting`: 512 / 2048
    *   `BiRefNet-HR-matting`: 1024 / 2560
    *   `BiRefNet_lite`: 512 / 2048
    *   `BiRefNet_lite-2K`: 1024 / 2560
    *   `BiRefNet_dynamic`: 512 / 2048
    *   `BiRefNet_lite-matting`: 512 / 2048

> **Примечание:** Если вы укажете значение `img_scale` вне допустимого диапазона, скрипт автоматически скорректирует его до ближайшей границы (min или max) и сообщит об этом в логе.

### Постобработка и сохранение

-   **`background`**: Тип фона (`Alpha`, `Solid`, `Original`).
-   **`sensitivity`**: Регулирует "агрессивность" маски. Диапазон от `0.0` (очень агрессивно) до `1.0` (очень деликатно).
-   **`mask_blur`**: Размытие краев маски. `0` - без размытия.
-   **`mask_offset`**: Смещение краев маски. Положительные значения расширяют, отрицательные — сужают.
-   **`invert_mask`**: Инвертировать финальную маску (объект станет фоном и наоборот).
-   **`fast_refine`**: Применить дополнительный алгоритм для смягчения полупрозрачных краев (полезно для волос).
-   **`save_options`**: Выбор сохраняемых файлов (`image`, `mask`, или оба).