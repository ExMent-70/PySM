# Руководство по "Сегментации по тексту (SAM2)" (v1.0.0)

## 1. Назначение

Этот скрипт позволяет вырезать любые объекты с фотографий, описывая их **обычным текстом**. Например, можно задать промпт "a red car" или "the woman in the blue dress", и скрипт постарается найти и выделить маской именно эти объекты. В основе лежит мощная связка моделей **GroundingDINO** (для поиска объекта по тексту) и **SAM2** (для точного построения маски).

## 2. Логика работы

1.  **Загрузка конфигурации:** Скрипт сначала загружает базовые настройки из файла `config.toml`, который находится в той же папке.
2.  **Получение параметров:** Затем он считывает параметры, указанные в интерфейсе PySM. **Параметры из PySM имеют приоритет** и переопределяют значения из `config.toml`.
3.  **Поиск изображений:** Скрипт сканирует папки из `sam2_inputs` и находит все поддерживаемые изображения.
4.  **Параллельная обработка:** Для каждого изображения:
    *   **GroundingDINO** анализирует изображение и текстовый промпт (`sam2_prompt`), чтобы найти bounding box (прямоугольник) вокруг искомого объекта.
    *   **SAM2** получает этот прямоугольник и строит по нему очень точную и детализированную маску объекта.
    *   Маска опционально улучшается фильтрами (сглаживание, заполнение дыр и т.д.).
5.  **Сохранение:** В выходной папке `sam2_output` для каждого исходного файла создается два результата: изображение с вырезанным объектом (`*_segmented.png`) и сама черно-белая маска (`*_mask.png`).

## 3. Ключевые параметры

*   `sam2_inputs`: Пути к исходным файлам или папкам, которые нужно обработать.
*   `sam2_output`: Папка, куда будут сохранены результаты.
*   `sam2_prompt`: **Самый важный параметр.** Текстовое описание объекта на английском языке. Чем точнее описание, тем лучше результат.
*   `sam2_threshold`: Порог уверенности (от 0.0 до 1.0). Если вы получаете много "мусорных" масок, попробуйте увеличить это значение (например, до `0.5`). Если нужный объект не находится, попробуйте уменьшить.
*   `sam2_fill_holes`: Очень полезная опция, которая заполняет "дыры" внутри объекта (например, пространство между рукой и телом).
*   `sam2_smooth`: Сглаживает "пиксельные", ступенчатые края маски, делая их более плавными.