# Руководство по скрипту "Создание/Обновление XMP" (v1.05.03)

## 1. Назначение

Этот скрипт является связующим звеном между этапом анализа изображений и программами для каталогизации, такими как Adobe Lightroom или Capture One. Его основная задача — взять данные, полученные в результате работы скрипта "Анализ RAW-файлов", и записать их в стандартные `.xmp` файлы-сайдкары.

## 2. Логика работы

1.  **Получает параметры:** Скрипт берет путь к текущей сессии (`wf_session_path`) и ее имя (`wf_session_name`) из Контекста Коллекции. Эти данные обычно устанавливаются предыдущими скриптами.
2.  **Находит JSON-файлы:** Внутри папки сессии он ищет файлы `info_portrait_faces.json` и `info_group_faces.json`, в которых хранится вся информация о найденных лицах.
3.  **Загружает шаблон:** Использует файл `template.xmp`, находящийся рядом со скриптом, как основу для создания новых `.xmp` файлов.
4.  **Обрабатывает изображения:** Для каждого изображения, упомянутого в JSON-файлах, скрипт:
    -   Либо создает новый `.xmp` файл из шаблона, либо открывает существующий.
    -   Заполняет или обновляет XMP-теги, такие как `dc:subject` (ключевые слова), `photoshop:Headline` (имя сессии) и пользовательские структуры `Iptc4xmpCore:SubjectCode` с подробной технической информацией о лицах.
5.  **Сохраняет файлы:** Записывает обновленные `.xmp` файлы в папку `Capture` рядом с исходными изображениями.

## 3. Параметры

-   **Путь к папке сессии** (`wf_session_path`):
    -   **Назначение:** Корневой путь к обрабатываемой сессии.
    -   **Источник:** Автоматически заполняется из переменной контекста `session_path`.

-   **Имя сессии** (`wf_session_name`):
    -   **Назначение:** Имя сессии для записи в метаданные.
    -   **Источник:** Автоматически заполняется из переменной контекста `session_name`.

-   **Количество потоков** (`all_threads`):
    -   **Назначение:** Определяет, сколько `.xmp` файлов могут создаваться одновременно.
    -   **Источник:** Можно изменить вручную.

## 4. Результат

В папке `Capture` рядом с каждым обработанным изображением будет создан или обновлен `.xmp` файл. После повторного открытия сессии в Lightroom или Capture One, программа прочитает эти файлы и отобразит новые ключевые слова и другую метаинформацию.