# Руководство по скрипту "Генератор CSV из папок" (v1.05.03)

## 1. Назначение

Этот скрипт предназначен для автоматизации создания CSV-таблиц на основе строго определённой структуры папок и имен файлов. Он сканирует указанные папки с портретами, извлекает из имен файлов информацию (имя, фамилия, номер) и собирает всё в единый CSV-файл, пригодный для импорта в другие системы.

## 2. Логика работы

1.  **Получает параметры:** Скрипт определяет корневую папку сессии (`__wf_psd_path`), имя будущего CSV-файла и список папок для анализа (`wf_portrait_folders`).
2.  **Сканирует папки:** Скрипт открывает каждую папку из списка `wf_portrait_folders` (например, папки "Портрет0", "Портрет1"), которые должны находится внутри родительской папки`__wf_psd_path`.
3.  **Парсит имена файлов:** Для каждого `.psd` или `.jpg` файла он пытается извлечь из имени данные по одному из шаблонов:
    -   `01-Фамилия Имя-0004.psd`
    -   `Фамилия Имя-0030.jpg`
4.  **Агрегирует данные:** Собирает все найденные фотографии, группируя их по уникальным персонам.
5.  **Генерирует CSV:** Создает и сохраняет CSV-файл в папку `{__wf_psd_path}.parent` (обычно это `<папка сессии>/Альбом/`). Файл имеет столбцы `Name`, `Surname`, `@img1`, `@img2` и т.д., где в ячейках `@img` содержатся относительные пути к файлам фотографий. Позднее данный файл используется в Adobe InDesign для автоматической верстки альбомов.

## 3. Параметры

-   **`__wf_psd_path`** (служебный):
    -   **Назначение:** Путь к корневой папке сессии.
    -   **Источник:** Задается вручную или формируется из переменных контекста `wf_psd_path` и `wf_session_name`.

-   **`wf_csv_file_name`**:
    -   **Назначение:** Имя для итогового CSV-файла.
    -   **Значение по умолчанию:** Если файл не задан, то в папке `{__wf_psd_path}.parent` создается файл `output.csv`.

-   **`wf_portrait_folders`**:
    -   **Назначение:** Список папок, которые нужно просканировать. Каждая папка указывается с новой строки.
    -   **Значение по умолчанию:** `Портрет0`, `Портрет1`, `Портрет2`.