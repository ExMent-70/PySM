# Руководство по использованию: Редактор списков v1.05.03

## 1. Назначение

**"Редактор списков"** — небольшой скрипт с графическим интерфейсом, для формирования списка класса/группы для фотосъемки. Скрипт импортирует неструктурированные данные, приводить их к единому формату, позволяет редактировать список и генерировать готовые к печати и экспорту документы.

## 2. Параметры запуска

Скрипт принимает следующие параметры:

-   **`wf_dest_dir`**:
    -   **Назначение:** Папка по умолчанию для сохранения всех файлов.
    -   **Источник:** Обычно автоматически заполняется из переменной контекста `session_path`.

-   **`wf_output_txt_file`**:
    -   **Назначение:** Позволяет указать точный, полный путь для сохранения файла `children.txt`. Если этот параметр задан, он имеет наивысший приоритет.
    -   **Источник:** Может быть установлен в контексте для сложных рабочих процессов.

-   **`wf_autosave_formats`**:
    -   **Назначение:** Управляет тем, какие дополнительные файлы будут созданы автоматически при сохранении основного `.list` файла.
    -   **Допустимые значения:** `html`, `txt`, `csv`. Можно выбрать несколько.
    -   **Значение по умолчанию:** `html`, `txt`.
	

## 3. Интерфейс приложения

Окно приложения разделено на несколько логических зон:

### 3.1. Верхняя панель
-   **Название класса:** Нередактируемое поле, автоматически заполняется из имени папки сессии. Рядом есть кнопка для быстрого открытия этой папки в проводнике.
-   **Вид фотоуслуги:** Выпадающий список с основными видами услуг. При изменении услуги автоматически меняется цена для **всех** учеников в таблице. Список услуг и цен загружается из файла `_services.json`.
-   **Стоимость:** Нередактируемое поле, показывающее цену для выбранной услуги.

### 3.2. Левая панель (с вкладками)
-   **Вкладка "Ввод":**
    -   **Режим разбора:** Позволяет выбрать один из двух алгоритмов:
        -   `Интеллектуальный (Natasha)`: Рекомендуемый режим. Использует продвинутые лингвистические модели для точного извлечения имен и фамилий, даже если они написаны в разном порядке.
        -   `Простой (по шаблону)`: Базовый режим, который ожидает, что в строке сначала идет фамилия, а потом имя.
    -   **Сырой список:** Большое текстовое поле для вставки скопированного списка учеников.
    -   **Кнопка "Обработать список":** Запускает парсинг текста и заполняет таблицу справа.
-   **Вкладка "Результат разбора":**
    -   Здесь отображается визуализация работы "Интеллектуального" парсера. Слова, распознанные как **Фамилия**, подсвечиваются синим, а как **Имя** — зеленым. Это помогает быстро оценить корректность разбора.

### 3.3. Правая панель
-   **Обработанный список:** Основной рабочий инструмент в виде таблицы. **(ОБНОВЛЕНО)** Для улучшения читаемости таблица теперь "полосатая" (фон строк чередуется).
-   **Итоги:** Под таблицей отображается актуальное количество учеников и общая сумма по всем выбранным услугам.

## 4. Работа с таблицей

Таблица обладает расширенной интерактивностью для удобного редактирования:

-   **Редактирование:** Дважды кликните на ячейку в редактируемых столбцах ("№ съемки", "Фамилия", "Имя", "Услуга", "Стоимость"), чтобы изменить ее значение.
-   **Навигация:** Используйте **Enter** и **стрелки вверх/вниз** для быстрого перемещения между ячейками в режиме редактирования.
-   **Валидация:** Система не позволит ввести некорректные данные (например, неуникальный номер съемки) и покажет сообщение об ошибке. При ошибке фокус останется на ячейке для исправления.
-   **Сортировка:** Кликните на заголовок столбца "№ съемки" или "Фамилия" для сортировки.
-   **Контекстное меню (правый клик мыши):**
    -   `Добавить строку`: Добавляет нового "Ученика" в конец списка.
    -   `Поменять Имя/Фамилию`: Меняет местами значения в ячейках "Имя" и "Фамилия" для выбранной строки.
    -   `Удалить выделенные строки`: Удаляет все выделенные строки.

## 5. Файловые операции (меню "Файл")

-   **Загрузить список текущей сессии:** Автоматически загружает файл `.list` из папки сессии.
-   **Сохранить список (`Ctrl+S`):** Сохраняет все данные в файл `.list` и парный ему `.html` в папке сессии.
-   **Сохранить как CSV... (НОВОЕ):** Экспортирует текущие данные из таблицы в файл формата CSV. Файл сохраняется в кодировке **UTF-16** с точкой с запятой (`;`) в качестве разделителя, что обеспечивает корректное открытие в Microsoft Excel. Порядок столбцов строго задан: `shoot_order`, `alpha_order`, `surname`, `name`, `service_type`, `service_cost`.
-   **Сохранить для обработки (children.txt):** Сортирует таблицу по "№ съемки" и сохраняет результат (только ФИО) в текстовый файл. Путь к файлу определяется параметром `wf_output_txt_file` или по умолчанию (`children.txt` в папке сессии).
-   **Печать HTML (`Ctrl+P`):** Сохраняет/обновляет HTML-отчет и открывает его в браузере для печати.

## 6. Кастомизация

-   **Услуги и цены:** Вы можете редактировать файл `_services.json`, который находится в той же папке, что и скрипт, чтобы изменить список услуг и их стоимость.
-   **Нормализация имен:** Вы можете добавлять свои варианты сокращенных имен в файл `_names_normalization.json`, чтобы улучшить их автоматическое преобразование в полные.

## 7.  Зависимости для скрипта "Редактор списков"

Для установки всех зависимостей выполните команду `pip install -r requirements.txt` или запустите файл `install_requirements.bat`

	**Основной фреймворк для создания графического интерфейса (GUI)**
	PySide6

	**Продвинутая библиотека для работы с регулярными выражениями (используется для парсинга)**
	regex

	**Библиотека для извлечения именованных сущностей (имена, фамилии) из текста на русском языке**
	natasha

	**Морфологический анализатор для русского языка (ключевая зависимость для natasha)**
	pymorphy3

	**Библиотека для красивой подсветки и визуализации результатов разбора текста**
	ipymarkup

	**Шаблонизатор для генерации HTML-отчетов**
	Jinja2