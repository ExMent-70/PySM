# Руководство по скрипту "Экспорт в JPEG" (v2.1.0)

## 1. Назначение

Скрипт **"Экспорт в JPEG"** является первым и обязательным шагом в рабочем процессе анализа фотографий. Его основная задача — преобразовать исходные файлы изображений из форматов RAW (например, `.CR2`, `.NEF`, `.ARW`) или PSD в универсальный формат JPEG. Это необходимо для того, чтобы последующие скрипты анализа могли работать с файлами быстро и эффективно.

## 2. Логика работы

1.  **Автоматическое определение путей:** Скрипт автоматически определяет рабочие папки на основе информации о текущем рабочем процессе (workflow) из PySM.
    *   **Исходная папка:** `{папка_сессии}/{имя_сессии}/Capture/{папка_фото_с_камеры}`
    *   **Целевая папка:** `{папка_сессии}/{имя_сессии}/Output/Analysis_{папка_фото_с_камеры}/JPG`
    Вам больше не нужно указывать эти пути вручную.

2.  **Получение параметров:** Остальные настройки (тип файлов, качество, размер) скрипт получает из интерфейса PySM.

3.  **Поиск файлов:** Скрипт сканирует исходную папку и находит все файлы, соответствующие выбранному типу (`a_r2j_image_type`).

4.  **Конвертация:** Каждый найденный файл обрабатывается в многопоточном режиме для ускорения процесса:
    *   Для **RAW-файлов**: извлекается встроенное в файл превью.
    *   Для **PSD-файлов**: извлекается финальное композитное (сведённое) изображение.

5.  **Масштабирование и сохранение:** Каждое извлеченное изображение масштабируется так, чтобы его длинная сторона не превышала заданный размер (`a_r2j_preview_size`), после чего сохраняется в выходную папку в формате JPEG с указанным качеством (`a_r2j_jpeg_quality`).

## 3. Параметры

-   **`a_r2j_image_type`**:
    -   **Назначение:** Определяет, какие типы файлов искать в исходной папке.
    -   **Варианты:**
        -   `raw`: Обрабатывать только RAW-файлы.
        -   `psd`: Обрабатывать только PSD-файлы.
        -   `all`: Обрабатывать и RAW, и PSD.
    -   **Значение по умолчанию:** `raw`.

-   **`a_r2j_preview_size`**:
    -   **Назначение:** Устанавливает максимальный размер длинной стороны для создаваемых JPEG-файлов. Например, значение `4096` означает, что итоговое изображение будет не более 4096px по ширине или высоте.
    -   **Значение по умолчанию:** `4096`.

-   **`a_r2j_jpeg_quality`**:
    -   **Назначение:** Качество сжатия JPEG по шкале от 1 до 100. Более высокое значение означает лучшее качество и больший размер файла.
    -   **Значение по умолчанию:** `95`.

-   **`all_threads`**:
    -   **Назначение:** Количество одновременных потоков для ускорения конвертации.
    -   **Значение по умолчанию:** `0`, что означает автоматическое определение по количеству ядер процессора.