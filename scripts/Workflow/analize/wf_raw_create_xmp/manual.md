# Руководство по скрипту "Создание/Обновление XMP" (v1.06.00)

## 1. Назначение

Этот скрипт является связующим звеном между этапом анализа изображений и программами для каталогизации, такими как Adobe Lightroom или Capture One. Его основная задача — взять все данные, полученные на предыдущих этапах анализа, и записать их в стандартные `.xmp` файлы-сайдкары.

## 2. Логика работы

1.  **Автоматическое определение путей:** Скрипт получает всю необходимую информацию о путях к папке сессии и файлам с результатами анализа напрямую из Контекста Коллекции PySM. Ручной ввод путей не требуется.

2.  **Находит JSON-файлы:** Внутри папки сессии он автоматически находит файлы `info_portrait_faces.json` и `info_group_faces.json`.

3.  **Загружает шаблон:** Использует файл `template.xmp`, находящийся рядом со скриптом, как основу для создания новых `.xmp` файлов.

4.  **Обрабатывает изображения:** Для каждого изображения, упомянутого в JSON-файлах, скрипт в многопоточном режиме:
    -   Либо создает новый `.xmp` файл из шаблона, либо открывает существующий.
    -   Заполняет или обновляет XMP-теги, такие как `dc:subject` (ключевые слова), `photoshop:Headline` (имя сессии) и пользовательские структуры с подробной технической информацией о лицах.

5.  **Сохраняет файлы:** Записывает обновленные `.xmp` файлы в папку `Capture` рядом с исходными изображениями.

## 3. Параметры

-   **Количество потоков** (`all_threads`):
    -   **Назначение:** Определяет, сколько `.xmp` файлов могут создаваться одновременно.
    -   **Источник:** Можно изменить вручную.

## 4. Результат

В папке `Capture` рядом с каждым обработанным изображением будет создан или обновлен `.xmp` файл. После повторного открытия сессии в Lightroom или Capture One, программа прочитает эти файлы и отобразит новые ключевые слова и другую метаинформацию.