# Руководство по скрипту "Сортировка файлов по кластерам" (v2.1.0)

## 1. Назначение

Скрипт **"Сортировка файлов по кластерам"** является финальным организационным этапом рабочего процесса. Его задача — навести порядок в файлах, физически распределив их по папкам в соответствии с результатами, полученными на этапе кластеризации.

Этот скрипт берет исходные файлы (например, `.jpg` и их `.xmp` сайдкары) и копирует или перемещает их в директории, названные именами людей (кластеров), которые были определены ранее.

## 2. Логика работы

1.  **Автоматическое определение путей:** Скрипт получает всю необходимую информацию о путях к папке сессии, файлам с результатами анализа и исходным изображениям напрямую из Контекста Коллекции PySM. Ручной ввод путей не требуется.

2.  **Загрузка данных:** Скрипт загружает `info_portrait_faces.json` и `info_group_faces.json`, чтобы получить информацию о том, к какому кластеру относится каждый файл.

3.  **Определение имени папки:** Для каждого файла из JSON скрипт определяет имя целевой папки:
    *   Для портретов используется формат `01-Имя Фамилия`.
    *   Для "шумовых" изображений — `99-Noise`.
    *   Для неопознанных кластеров — `98-Unknown_X`.
    *   Для всех групповых фото — `_Group_Photos`.

4.  **Поиск и обработка:** В многопоточном режиме для каждого исходного файла:
    *   Скрипт ищет во всех исходных папках файлы с таким же именем, но с разными расширениями из списка `a_sf_extensions`.
    *   Выполняет выбранную операцию (`a_sf_operation`): `copy` (копирует) или `move` (перемещает) все найденные файлы в соответствующую папку кластера.

## 3. Параметры

-   **`a_sf_operation`**:
    -   **Назначение:** Определяет, какое действие выполнять с файлами.
    -   **Варианты:**
        -   `copy`: **(Безопасно)** Файлы будут скопированы в папки кластеров, оригиналы останутся на месте.
        -   `move`: Файлы будут перемещены.
    -   **Значение по умолчанию:** `move`.

-   **`a_sf_extensions`**:
    -   **Назначение:** Список расширений (включая точку), которые скрипт будет искать и обрабатывать.
    -   **Пример:** `.jpg .xmp .cr2` — обработает JPEG, XMP и CR2 файлы.
    -   **Значение по умолчанию:** `.jpg .xmp .cr3`.

-   **`all_threads`**:
    -   **Назначение:** Количество одновременных потоков для ускорения операций с файлами.
    -   **Значение по умолчанию:** `0` (автоматическое определение по количеству ядер процессора).