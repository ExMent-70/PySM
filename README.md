### **PySM - Python Script Manager**

**1. Что такое PySM?**

**PySM (Python Script Manager)** — это desktop-приложение с графическим интерфейсом, предназначенное для управления и выполнения Python-скриптов. Его основная цель — предоставить стандартизированную среду для запуска скриптов, которые требуют различных параметров командной строки, и объединять их в сложные, автоматизированные рабочие процессы.
<img width="1179" height="880" alt="2025-07-24_23-40-47" src="https://github.com/user-attachments/assets/48460c05-6b26-4fcd-9f48-271674f7d635" />

PySM позволяет вам:
*   Каталогизировать и организовывать ваши скрипты, даже если они разбросаны по разным директориям.
*   Настраивать и многократно использовать один и тот же скрипт с разными наборами входных параметров без необходимости модифицировать код или использовать командную строку.
*   Строить последовательные или ветвящиеся цепочки выполнения (Наборы) из ваших скриптов.
*   Организовывать обмен данными между скриптами в рамках одного рабочего процесса.
*   Отслеживать ход выполнения и анализировать результаты в удобной консоли.

По своей сути, PySM превращает набор ваших разрозненных скриптов в структурированный, воспроизводимый и легко управляемый **рабочий процесс**.

**2. Для кого это приложение?**

PySM создавался, в первую очередь, "для себя" и "под себя", для автоматизации рабочего процесса школьного фотографа. Но программа получилась довольно универсальной, подходящей для всех, кто регулярно использует (собирается использовать) небольшие скрипты Python в своей работе. Если ваша работа включает в себя многократный запуск Python-скриптов с изменением их аргументов, PySM поможет вам систематизировать этот процесс и сэкономить время.

**3. Ключевые понятия (Глоссарий)**

Для эффективной работы с PySM необходимо понимать несколько основных концепций:

*   **Скрипт:** Фундаментальная единица автоматизации. В контексте PySM, это не просто `.py` файл, а инкапсулированная **Папка-скрипт**.
*   **Папка-скрипт:** Специальным образом организованная директория. Чтобы PySM "увидел" ваш скрипт, он должен находиться в папке, внутри которой есть два обязательных файла: исполняемый `run_<имя_папки>.py` и файл-описание `script_passport.json`.
*   **Коллекция (`.pysmc`):** Ваш проект или **Рабочий процесс**. Это главный файл, который вы сохраняете и загружаете. Он хранит в себе всю информацию: ссылки на папки с вашими скриптами, структуру Наборов, настроенные параметры для каждого шага и данные для обмена между ними.
*   **Набор (Set):** Упорядоченная последовательность шагов, предназначенная для выполнения одной большой задачи. Например, Набор "Подготовка отчета за месяц" может состоять из шагов: "1. Скачать данные", "2. Обработать данные", "3. Сгенерировать PDF".
*   **Экземпляр (Instance):** Конкретный шаг внутри Набора. Когда вы добавляете Скрипт в Набор, вы создаете его Экземпляр. Вы можете добавить один и тот же Скрипт несколько раз как разные Экземпляры с разными параметрами. Например, Экземпляр 1: "Скачать данные за январь" (с параметром `month=1`), Экземпляр 2: "Скачать данные за февраль" (с параметром `month=2`).
*   **Контекст:** "Общая память" или "доска объявлений" для всех скриптов, выполняющихся в рамках одной Коллекции. Это позволяет одному скрипту записать результат своей работы в Контекст, а следующему — прочитать его и использовать в своей логике.
*   **Корневая директория (Script Root):** Папка на вашем диске, которую вы указываете в настройках Коллекции. PySM будет рекурсивно сканировать эту папку и все ее подпапки в поисках Папок-скриптов.


#### **Раздел 1: Установка и Первый запуск**

**1.1. Портативность и системные требования**

PySM поставляется как **портативное приложение**. Это означает, что оно не требует установки в операционную систему и может быть запущено с любого носителя (включая USB-накопители).

*   **Встроенный Python:** Приложение включает в себя собственную, полностью настроенную и протестированную версию **Python 3.11.9**. Это гарантирует, что работа PySM не будет зависеть от версий Python, установленных в вашей системе, и предотвращает возможные конфликты библиотек.
*   **Запуск:** Для запуска приложения используйте файл `RUN.bat`, расположенный в корневой директории PySM. Он автоматически настроит все необходимые пути для корректной работы.
*   **Для продвинутых пользователей:** Краткое упоминание, что при желании можно запустить `main.py` с помощью системного Python (требуется версия 3.9 или выше), но это потребует ручной установки зависимостей (например, через `pip install -r requirements.txt`). Однако для стабильной работы рекомендуется использовать `RUN.bat`.

**1.2. Обзор главного окна**

После запуска вы увидите главный интерфейс приложения, который состоит из нескольких ключевых областей.

*(Здесь будет размещен скриншот главного окна с цифровыми метками)*

1.  **Панель инструментов:** Горизонтальная панель вверху окна. Предоставляет быстрый доступ к основным действиям: создание, открытие и сохранение Коллекций, обновление списка скриптов, вызов окна настроек и т.д.
2.  **Область "Доступные скрипты":** Панель в левой части окна. В ней отображается иерархическое дерево всех Скриптов, которые PySM обнаружил в указанных вами Корневых директориях. Это ваша "библиотека" доступных инструментов.
3.  **Область "Коллекция наборов":** Панель под списком доступных скриптов. Это ваша рабочая область, где вы конструируете Наборы, перетаскивая в них Экземпляры скриптов и настраивая их.
4.  **Панель управления запуском:** Находится под деревом Коллекции. Здесь вы выбираете режим выполнения (например, автоматический или пошаговый) и нажимаете кнопки для запуска, остановки или перехода к следующему шагу.
5.  **Консоль вывода:** Правая, самая большая панель. Сюда выводится вся текстовая информация от ваших скриптов (`print`, логирование), а также служебные сообщения от самого PySM. Здесь вы отслеживаете ход выполнения и ищете ошибки.
6.  **Строка состояния:** Узкая полоса в самом низу окна. Отображает краткую информацию о текущем состоянии приложения (например, "Готово", "Сканирование...", "Выполнение набора...").

**1.3. Портативность и организация файлов**

Для обеспечения стабильной работы и легкого переноса ваших рабочих процессов между компьютерами или для совместного использования с коллегами, рекомендуется придерживаться консолидированной структуры хранения файлов.

*   **Рекомендуемая структура:**
    Создайте одну общую папку для всех ваших проектов в PySM. Внутри нее создайте две подпапки: одну для Коллекций (`.pysmc` файлов) и одну для Скриптов.
    ```
    My_PySM_Projects/
    ├── script_collections/
    │   ├── daily_report.pysmc
    │   └── photo_processing.pysmc
    └── scripts/
        ├── system_utils/
        │   └── check_disk_space/
        │       ├── run_check_disk_space.py
        │       └── script_passport.json
        └── data_pipelines/
            └── parse_csv/
                ├── run_parse_csv.py
                └── script_passport.json
    ```
    При такой организации, когда вы будете указывать Корневую директорию в настройках Коллекции, вы сможете использовать относительный путь (например, `../scripts`). Вся папка `My_PySM_Projects` становится полностью автономной и переносимой. Вы можете скопировать ее на другой компьютер, и все будет работать "из коробки".

*   **Не рекомендуемый пример (разрозненная структура):**
    *   Файл Коллекции `daily_report.pysmc` сохранен в `C:\Users\User\Documents`.
    *   Корневая директория скриптов для этой коллекции указывает на абсолютный путь, например, `D:\Work\Project_X\automation_scripts`.
    Такой проект будет работать только на вашем текущем компьютере. При попытке открыть его на другой машине или после изменения структуры дисков, PySM не сможет найти Скрипты, так как абсолютные пути станут недействительными.

#### **Раздел 2: Интеграция и настройка ваших скриптов**

**2.1. Подключение существующих скриптов**

Философия PySM заключается не в том, чтобы заставить вас переписывать существующий код, а в том, чтобы "обернуть" его, предоставив стандартный интерфейс для управления и запуска.

*   **Шаг 1: Подготовка Папки-скрипта.**
    Предположим, у вас есть скрипт `my_script.py`. Чтобы PySM мог с ним работать, нужно выполнить простое действие:
    1.  Создайте для него отдельную папку, например, `my_cool_script`.
    2.  Переместите `my_script.py` внутрь и переименуйте его по шаблону `run_<имя_папки>.py`. В нашем случае это будет `run_my_cool_script.py`.
    Это единственное обязательное изменение в структуре файла.

*   **Шаг 2: Создание Паспорта — Просто и Автоматически.**
    Паспорт (`script_passport.json`) — это "визитная карточка" вашего скрипта для PySM.
    **Важное замечание:** Вам **не нужно создавать этот файл вручную**. PySM создаст его **автоматически**, когда вы впервые отредактируете свойства вашего скрипта через интерфейс. Мы описываем его здесь, чтобы вы понимали, как все устроено "под капотом".

*   **Шаг 3: Добавление в PySM.**
    1.  Запустите PySM и создайте новую Коллекцию (кнопка "Новая коллекция" на панели инструментов).
    2.  Откройте "Паспорт Коллекции" (кнопка с иконкой "i" на панели инструментов).
    3.  В открывшемся диалоге нажмите "Добавить..." и выберите папку, **содержащую** вашу папку `my_cool_script` (например, `.../scripts/`), как **Корневую директорию**.
    4.  Закройте диалог и нажмите "Обновить список скриптов" (кнопка с круговыми стрелками). Ваш скрипт появится в дереве слева. Сначала он будет помечен как "сырой", требующий настройки.

**2.2. Диалог "Свойства скрипта" (Режим Паспорта)**

Это ваш основной инструмент для "знакомства" скрипта с PySM. Чтобы его открыть, дважды кликните по вашему новому скрипту в левом дереве.

*   **Вкладка "Общие":** Здесь вы можете задать человекочитаемое описание, указать автора и версию.
*   **Вкладка "Аргументы":** Самая важная вкладка. Здесь вы описываете параметры, которые принимает ваш скрипт.
    *   **Автоматическое сканирование:** Нажмите кнопку "Сканировать файл...". PySM проанализирует ваш `run_...py` файл и автоматически найдет все аргументы, определенные с помощью стандартной библиотеки `argparse`, заполнив таблицу за вас.
    *   **Ручное добавление:** Вы также можете нажать "Добавить" и вручную описать каждый аргумент: его имя (без `--`), тип данных (`string`, `int`, `bool`, `dir_path` и т.д.), значение по умолчанию и текстовое описание (подсказку).
*   **Вкладка "Дополнительно":** Здесь можно указать путь к специфическому интерпретатору Python, если ваш скрипт требует особой версии или окружения.
*   **Кнопка "Справка":** Если в папке вашего скрипта есть файл `manual.md`, эта кнопка откроет его содержимое в удобном для чтения виде. Это отличный способ документировать сложные скрипты для себя и коллег.

После заполнения необходимых полей и нажатия "ОК", PySM создаст в папке скрипта файл `script_passport.json`. Скрипт станет валидным и готовым к использованию.

#### **Раздел 3: Создание и управление Рабочими процессами (Коллекциями)**

**3.1. Коллекция как Рабочий процесс**

**Коллекция — это ваш сохраненный рабочий процесс.** Это не просто список скриптов, а полноценный проект, который содержит все шаги (Наборы), их последовательность, индивидуальные настройки для каждого шага и переменные (Контекст), необходимые для выполнения задачи от начала до конца.

Наличие нескольких файлов Коллекций (`.pysmc`) позволяет вам управлять разными процессами или версиями одного процесса:
*   **Разные процессы:** `daily_report.pysmc` и `archive_projects.pysmc`.
*   **Разные версии одного процесса:** `photo_processing_fast.pysmc` (быстрая обработка с низким качеством) и `photo_processing_hq.pysmc` (долгая обработка с высоким качеством).

**3.2. Сохранение и загрузка Коллекций**

Управление Коллекциями происходит через панель инструментов:
*   **"Новая коллекция":** Создает пустой рабочий процесс.
*   **"Открыть":** Загружает существующий `.pysmc` файл.
*   **"Сохранить":** Сохраняет текущие изменения в открытый `.pysmc` файл.
*   **"Сохранить как...":** Позволяет сохранить текущий рабочий процесс в новый `.pysmc` файл, создавая его полную, независимую копию.

**3.3. Диалог "Паспорт Коллекции"**

Этот диалог (кнопка с иконкой "i") — центр управления вашим рабочим процессом.
*   **Вкладка "Свойства":** Здесь задается имя и описание всего процесса.
*   **Вкладка "Корневые директории":** Здесь вы управляете списком папок, в которых PySM ищет Скрипты для этого конкретного процесса.
*   **Вкладка "Контекст":** Это "общая память" вашего процесса. Здесь можно заранее определить переменные, которые будут доступны всем скриптам при запуске. Например, можно задать переменную `output_folder` с путем к папке для результатов, и все скрипты смогут его использовать.

#### **Раздел 4: Построение и запуск Наборов**

**4.1. Наборы и Экземпляры**

Если Коллекция — это весь рабочий процесс, то **Набор** — это конкретный "рецепт" или последовательность шагов внутри него.

Чтобы добавить шаг в Набор:
1.  Создайте Набор в области "Коллекция наборов".
2.  Выберите нужный Скрипт в левом дереве "Доступные скрипты".
3.  Нажмите кнопку "Добавить в набор".

В Наборе появится **Экземпляр** этого Скрипта. Вы можете менять порядок экземпляров простым перетаскиванием (Drag-and-Drop).

**4.2. Диалог "Параметры экземпляра"**

Двойной клик по Экземпляру в Наборе открывает диалог его настройки. Здесь вы можете:
1.  Задать ему уникальное, понятное имя (например, "Шаг 1: Конвертировать JPG в PNG").
2.  Переопределить значения аргументов специально для этого шага, не затрагивая основной паспорт Скрипта. Например, для одного экземпляра указать `input_file="a.jpg"`, а для другого — `input_file="b.jpg"`.

**4.3. Режимы запуска**

Перед запуском Набора вы можете выбрать режим его выполнения в выпадающем меню:
*   **Весь набор (авто):** "Запустить и забыть". Идеально для полностью автоматизированных цепочек.
*   **Весь набор (пошагово):** "Контроль на каждом шаге". PySM будет выполнять по одному скрипту и ждать вашей команды "Следующий шаг". Удобно для отладки.
*   **Условный (авто):** "Интеллектуальный процесс". Для сценариев, где логика скрипта сама решает, что делать дальше (см. Раздел 5.2).
*   **Условный (пошагово):** "Интерактивная отладка". Комбинация контроля и интеллектуальной логики.
*   **Только выбранный из набора:** "Быстрый тест". Позволяет запустить один конкретный шаг, не выполняя весь Набор.

**4.4. Запуск Набора и анализ результатов**

После выбора Набора и режима нажмите "Выполнить". В области "Коллекция наборов" вы увидите, как меняются статусы Экземпляров (иконки и цвет фона). В Консоли вывода будет отображаться весь текстовый вывод ваших скриптов, что позволяет детально отслеживать процесс и анализировать ошибки.
